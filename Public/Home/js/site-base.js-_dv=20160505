;/*!/widgets/site-basejs/msg.js*/
define("common:widgets/site-basejs/msg",function(s,e,o){{var i=s("common:lib/jquery/jquery-1.11.3");s("common:lib/underscore/underscore-min")}s("common:lib/jquery.cookie/jquery.cookie");var t={msgPop:null,setPopMsg:function(s){if(s){var e=[];e.push('<div id="MzMsgPop">'),e.push('<a class="title" href="'+s.href+'" target="_blank">'+s.title+"</a>"),e.push('<div class="triangle"></div>'),e.push('<div class="close"></div>'),e.push("</div>"),this.msgPop=i(e.join("")),i(".topbar-info-pop").append(this.msgPop),this.msgPop.children(".close").on("click",function(){i(this).parent().remove()})}else this.msgPop&&this.msgPop.remove()},setMsgStatus:function(s){s?i("#MzMsgTag").show():i("#MzMsgTag").hide()},getMsgStatus:function(s,e,o){var t=this;return"function"!=typeof e?!1:void i.ajax({url:"http://store.meizu.com/vip/user/home_page/message/"+s,dataType:"jsonp",success:function(s){s&&200===s.code?e.call(t,s):"function"==typeof o&&o.call(t,s)},error:function(){}})}};o.exports=t});
;/*!/widgets/site-basejs/orderMsg.js*/
define("common:widgets/site-basejs/orderMsg",function(o,e,r){{var t=o("common:lib/jquery/jquery-1.11.3");o("common:lib/underscore/underscore-min")}o("common:lib/jquery.cookie/jquery.cookie");var n={setMsgStatus:function(o){o?t("#MzOrderMsgTag").show():t("#MzOrderMsgTag").hide()},getMsgStatus:function(o,e,r){var n=this;return"function"!=typeof e?!1:void t.ajax({url:"http://store.meizu.com/vip/order/statusnum/"+o,dataType:"jsonp",success:function(o){o&&200===o.code?e.call(n,o):"function"==typeof r&&r.call(n,o)},error:function(){}})}};r.exports=n});
;/*!/widgets/site-basejs/login.js*/
define("common:widgets/site-basejs/login",function(o,e,i){var n=o("common:lib/jquery/jquery-1.11.3");o("common:lib/jquery.cookie/jquery.cookie");var r=n.cookie("MEIZUSTORESESSIONVAL"),s=!1;r&&(s=!0,r=JSON.parse(r)),i.exports={isLogin:s,userInfo:r}});
;/*!/widgets/site-topbar/topbar.js*/
define("common:widgets/site-topbar/topbar",function(e){function t(e){var t=i(e?".site-logout":".site-login"),o=t.data("href"),s=window.location.href;t.attr("href",o+s)}function o(e){i("#MzTopbarMsg").show(),a.getMsgStatus(e,function(e){var t=e.data,o=e.data.message_active;(t.sysMessage||t.actMessage||t.notification)&&a.setMsgStatus(!0),o.length>0&&a.setPopMsg({title:o[0].title,href:o[0].link})})}function s(e){r.getMsgStatus(e,function(e){parseInt(e.data.unPayNum)>0&&r.setMsgStatus(!0)})}function n(){i(".mz_login").hide(),i("#MzUserName").html(u.userInfo.username),i(".topbar-info-member").show()}{var i=e("common:lib/jquery/jquery-1.11.3");e("common:lib/underscore/underscore-min")}e("common:lib/jquery.cookie/jquery.cookie");var a=e("common:widgets/site-basejs/msg"),r=e("common:widgets/site-basejs/orderMsg"),u=e("common:widgets/site-basejs/login");!function(){u.isLogin?(t(!0),o(u.userInfo.uid),s(u.userInfo.uid),n()):t()}()});
;/*!/widgets/site-header/header.js*/
define("common:widgets/site-header/header",function(t,e,a){function r(){n(),d.initCart()}function n(){var t,e=0,a=0,r=i("#MzNavMenu"),n=r.find("> .mzcontainer");i(".nav-item").mouseenter(function(){t=!0;var a=i(this).find(".menu-product-list");0!==a.length?(n.html(a.clone()),n.find(".menu-product-figure img").each(function(){i(this).attr("src",i(this).attr("data-src"))}),e=setTimeout(function(){r.stop(!0,!1).slideDown(200)},200)):r.stop(!0,!1).slideUp(200)}).mouseleave(function(){clearTimeout(e),e=null,t=!1,a=setTimeout(function(){r.stop(!0,!0).slideUp(200)},200)}),i(".nav-list").mouseover(function(){clearTimeout(a),a=null}),r.mouseenter(function(){clearTimeout(a),a=null}).mouseleave(function(){a=setTimeout(function(){t||r.slideUp()},200)})}var i=t("common:lib/jquery/jquery-1.11.3"),s=t("common:lib/underscore/underscore-min");t("common:lib/jquery.cookie/jquery.cookie"),t("common:lib/jquery.cookie/jquery.cookie");var c=(t("common:widgets/site-basejs/login"),i.cookie("mz_cart_count")),d={emptyTpl:'<div class="header-cart-empty" data-load="正在加载购物车信息 ..." data-empty="购物车还没有商品，快购买吧！">\n  <img src="http://store.res.meizu.com/resources/php/store/static/common/widgets/site-header/100x100.gif"  width="35" alt="正在加载 ..." />\n</div>\n',cartListTpl:'<div class="header-cart-list">\n <ul>\n   <% _.map(data, function(v, key){ %>\n   <li>\n     <div class="header-cart-item-figure">\n       <a href="http://store.meizu.com/product/<%= v.SN %>.html" target="_blank">\n         <img src="<%= v.CartIMG %>" alt="<%= v.VerName %>" height="40" width="40" />\n       </a>\n     </div>\n     <div class="header-cart-item-desc">\n       <a href="http://store.meizu.com/product/<%= v.SN %>.html" target="_blank">\n         <h5><%= v.ProductName %></h5>\n       </a>\n       <span class="product-prop"><%= v.VerName %></span>\n     </div>\n     <div class="header-cart-item-price">\n       <span class="product-price">&yen;<%= v.Price %>&times;<%= v.number %></span>\n     </div>\n     <span data-key="<%= key %>" class="cart-product-delbtn"></span>\n   </li>\n   <% }) %>\n </ul>\n <div class="header-cart-operate">\n   <div class="header-cart-total" style="display:none;">\n     <p>共<span id="MzHeaderCartTotalNum">0</span>件商品</p>\n     <span class="cart-total-price">&yen;0.00</span>\n   </div>\n   <div class="header-cart-right">\n     <a class="cart-btn header-cart-gopay" href="http://store.meizu.com/cart" target="_blank">去购物车结算</a>\n   </div>\n </div>\n</div>\n',timeOverFlag:0,initCart:function(){var t="header-cart-hover";this.MzHeaderCart=i("#MzHeaderCart"),this.detail=this.MzHeaderCart.find(".header-cart-detail");var e=!0,a=this;this.updateNum(c),this.detail.on("click",".cart-product-delbtn",i.proxy(this.delHandler,this)),this.MzHeaderCart.mouseenter(s.debounce(function(){if(clearTimeout(a.timeOverFlag),a.MzHeaderCart.hasClass(t))return!1;a.detail.html(a.emptyTpl),a.MzHeaderCart.addClass(t);var r=a.detail.find(".header-cart-empty");return r.html(r.attr("data-empty")),e?(e=!0,void i.ajax({url:"/home_static/home/get_cart_data",cache:!1,dataType:"json",success:function(t){e=!0,1!==t.status||s.isEmpty(t.data)?r.html(r.attr("data-empty")):a.loadCartHandler(t.data)},error:function(){r.html("服务繁忙 ..."),e=!0}})):!1},300,!0)).mouseleave(function(){a.timeOverFlag=setTimeout(function(){a.MzHeaderCart.removeClass(t)},200)})},updateNum:function(t){var e=i("#MzHeaderCartNum");if(t>0)e.html(t).addClass("existence");else{e.html(t).removeClass("existence"),this.detail.html(this.emptyTpl);var a=this.detail.find(".header-cart-empty");a.html(a.attr("data-empty"))}},updateTotalNum:function(t){i("#MzHeaderCartTotalNum").html(t)},loadCartHandler:function(t){var e=0;if(this.updateNum(e=s.size(t)),0===e)return!1;var a=this.cartListTpl,r=s.template(a)({data:t});this.cartDatas=t,this.detail.html(r)},delHandler:function(t){t.preventDefault();var e=i(t.target),a=e.attr("data-key"),r=this.cartDatas[a],n=this,c={del:a,num:r.number,package_id:r.SelectPackage,package_key:"all",insurance_id:r.insurance_id};i.ajax({url:"/cart/del",data:c,cache:!1,method:"GET",dataType:"json",success:function(t){1===t.status?(delete n.cartDatas[a],n.loadCartHandler(n.cartDatas),n.updateNum(s.size(n.cartDatas))):alert("删除失败，请稍后再试")},error:function(){alert("服务繁忙，请稍后再试")}})}};r(),a.exports={}});